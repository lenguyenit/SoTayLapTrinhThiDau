<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPH - Chương 26: Các thuật toán xử lý chuỗi</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }
        h1, h2, h3 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        h1 { margin-top: 40px; }
        p { margin-bottom: 15px; text-align: justify; }
        
        /* Code styling */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
        }
        code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background-color: #f1f3f5;
            padding: 2px 4px;
            border-radius: 3px;
            color: #d63384;
        }
        
        /* Syntax highlighting */
        .cpp-keyword { color: #0000ff; font-weight: bold; }
        .cpp-type { color: #2b91af; }
        .cpp-number { color: #098658; }
        .cpp-func { color: #795e26; }
        .cpp-comment { color: #008000; font-style: italic; }

        /* Graphics Containers */
        .graphic-box {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        /* SVG Styling */
        svg text { font-family: "Segoe UI", sans-serif; font-size: 14px; text-anchor: middle; dominant-baseline: central; font-weight: bold; }
        .node-circle { fill: #fff; stroke: #2c3e50; stroke-width: 2; }
        .node-root { fill: #e3f2fd; stroke: #2196f3; stroke-width: 2; }
        .node-end { fill: #e8f5e9; stroke: #2e7d32; stroke-width: 2; }
        .edge-line { stroke: #555; stroke-width: 2; }
        .edge-label-bg { fill: white; opacity: 0.8; }
        .array-rect { fill: #fff; stroke: #333; stroke-width: 1; }
        .highlight-rect { fill: #fff9c4; stroke: #fbc02d; stroke-width: 2; }
        .highlight-text { fill: #d35400; }

        /* TOC */
        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            margin-bottom: 30px;
        }
        .toc ul { list-style-type: none; padding-left: 0; }
        .toc a { text-decoration: none; color: #007bff; font-weight: 500; }
    </style>
</head>
<body>

    <div class="toc">
        <h3>Mục lục - Chương 26</h3>
        <ul>
            <li><a href="#intro">Thuật toán chuỗi</a></li>
            <li><a href="#sec26.1">26.1 Cấu trúc Trie</a></li>
            <li><a href="#sec26.2">26.2 Băm chuỗi</a></li>
            <li><a href="#sec26.3">26.3 Thuật toán Z</a></li>
            <li><a href="#sec26.4">26.4 Thuật toán KMP</a></li>
        </ul>
    </div>

    <h1 id="intro">Chương 26: Các thuật toán xử lý chuỗi (String algorithms)</h1>
    <p>
        Chương này giới thiệu các thuật toán và cấu trúc dữ liệu hiệu quả để xử lý chuỗi ký tự. Một số thuật ngữ cơ bản:
    </p>
    <ul>
        <li><strong>Tiền tố (Prefix):</strong> Chuỗi con bắt đầu từ vị trí đầu tiên.</li>
        <li><strong>Hậu tố (Suffix):</strong> Chuỗi con kết thúc ở vị trí cuối cùng.</li>
        <li><strong>Chuỗi con (Substring):</strong> Một đoạn các ký tự liên tiếp trong chuỗi.</li>
    </ul>

    <h2 id="sec26.1">26.1 Cấu trúc Trie (Trie structure)</h2>
    <p>
        Trie (hay Prefix Tree) là một cấu trúc dữ liệu cây dùng để lưu trữ một tập hợp các chuỗi. Mỗi nút trong cây đại diện cho một tiền tố của một hoặc nhiều chuỗi trong tập hợp.
    </p>

    <div class="graphic-box">
        <svg width="400" height="250" viewBox="0 0 400 250">
            <g id="trie-edges">
                <line x1="200" y1="30" x2="200" y2="80" class="edge-line"/> <line x1="200" y1="80" x2="140" y2="140" class="edge-line"/> <line x1="200" y1="80" x2="260" y2="140" class="edge-line"/> <line x1="140" y1="140" x2="80" y2="200" class="edge-line"/> <line x1="140" y1="140" x2="200" y2="200" class="edge-line"/> <line x1="260" y1="140" x2="320" y2="200" class="edge-line"/> </g>

            <g id="edge-labels" font-size="12" fill="#555" font-weight="bold">
                <rect x="205" y="50" width="10" height="15" class="edge-label-bg"/> <text x="210" y="60">t</text>
                <rect x="160" y="100" width="10" height="15" class="edge-label-bg"/> <text x="165" y="110">h</text>
                <rect x="235" y="100" width="10" height="15" class="edge-label-bg"/> <text x="240" y="110">o</text>
                <rect x="100" y="160" width="10" height="15" class="edge-label-bg"/> <text x="105" y="170">e</text>
                <rect x="160" y="160" width="10" height="15" class="edge-label-bg"/> <text x="165" y="170">i</text>
                <rect x="295" y="160" width="10" height="15" class="edge-label-bg"/> <text x="300" y="170">p</text>
            </g>

            <g id="trie-nodes">
                <circle cx="200" cy="30" r="15" class="node-root"/>
                <circle cx="200" cy="80" r="15" class="node-circle"/>
                <circle cx="140" cy="140" r="15" class="node-circle"/>
                <circle cx="260" cy="140" r="15" class="node-end"/> <circle cx="80" cy="200" r="15" class="node-end"/> <circle cx="200" cy="200" r="15" class="node-end"/> <circle cx="320" cy="200" r="15" class="node-end"/> </g>
            <text x="200" y="240" font-size="12" font-style="italic" fill="#666">Các từ: "to", "the", "thi", "top"</text>
        </svg>
    </div>

    <h3>Cài đặt Trie</h3>
<pre><code><span class="cpp-keyword">const</span> <span class="cpp-keyword">int</span> N = <span class="cpp-number">100005</span>;
<span class="cpp-keyword">int</span> trie[N][<span class="cpp-number">26</span>]; <span class="cpp-comment">// trie[u][c] là con của u khi đi theo ký tự c</span>
<span class="cpp-keyword">bool</span> stop[N];    <span class="cpp-comment">// Đánh dấu kết thúc từ</span>
<span class="cpp-keyword">int</span> cnt = <span class="cpp-number">0</span>;     <span class="cpp-comment">// Đếm số lượng nút</span>

<span class="cpp-keyword">void</span> <span class="cpp-func">insert</span>(<span class="cpp-type">string</span> s) {
    <span class="cpp-keyword">int</span> u = <span class="cpp-number">0</span>;
    <span class="cpp-keyword">for</span> (<span class="cpp-keyword">char</span> c : s) {
        <span class="cpp-keyword">if</span> (!trie[u][c - <span class="cpp-string">'a'</span>]) {
            trie[u][c - <span class="cpp-string">'a'</span>] = ++cnt;
        }
        u = trie[u][c - <span class="cpp-string">'a'</span>];
    }
    stop[u] = <span class="cpp-keyword">true</span>;
}

<span class="cpp-keyword">bool</span> <span class="cpp-func">search</span>(<span class="cpp-type">string</span> s) {
    <span class="cpp-keyword">int</span> u = <span class="cpp-number">0</span>;
    <span class="cpp-keyword">for</span> (<span class="cpp-keyword">char</span> c : s) {
        <span class="cpp-keyword">if</span> (!trie[u][c - <span class="cpp-string">'a'</span>]) <span class="cpp-keyword">return</span> <span class="cpp-keyword">false</span>;
        u = trie[u][c - <span class="cpp-string">'a'</span>];
    }
    <span class="cpp-keyword">return</span> stop[u];
}</code></pre>

    <h2 id="sec26.2">26.2 Băm chuỗi (String hashing)</h2>
    <p>
        Băm chuỗi là kỹ thuật chuyển đổi chuỗi thành số nguyên để so sánh nhanh chóng.
        Công thức <strong>Băm đa thức (Polynomial Rolling Hash)</strong>:
        $$ \text{hash}(s) = (s_0 \cdot A^{n-1} + s_1 \cdot A^{n-2} + \dots + s_{n-1} \cdot A^0) \pmod B $$
    </p>

    <h3>Cài đặt</h3>
<pre><code><span class="cpp-type">long</span> <span class="cpp-type">long</span> h[N], p[N];
<span class="cpp-keyword">const</span> <span class="cpp-keyword">int</span> A = <span class="cpp-number">31</span>;
<span class="cpp-keyword">const</span> <span class="cpp-keyword">int</span> B = <span class="cpp-number">1e9</span> + <span class="cpp-number">9</span>;

<span class="cpp-keyword">void</span> <span class="cpp-func">build_hash</span>(<span class="cpp-type">string</span> s) {
    <span class="cpp-keyword">int</span> n = s.size();
    h[<span class="cpp-number">0</span>] = s[<span class="cpp-number">0</span>];
    p[<span class="cpp-number">0</span>] = <span class="cpp-number">1</span>;
    <span class="cpp-keyword">for</span> (<span class="cpp-keyword">int</span> i = <span class="cpp-number">1</span>; i &lt; n; i++) {
        h[i] = (h[i-<span class="cpp-number">1</span>] * A + s[i]) % B;
        p[i] = (p[i-<span class="cpp-number">1</span>] * A) % B;
    }
}

<span class="cpp-type">long</span> <span class="cpp-type">long</span> <span class="cpp-func">get_hash</span>(<span class="cpp-keyword">int</span> l, <span class="cpp-keyword">int</span> r) {
    <span class="cpp-keyword">if</span> (l == <span class="cpp-number">0</span>) <span class="cpp-keyword">return</span> h[r];
    <span class="cpp-type">long</span> <span class="cpp-type">long</span> res = (h[r] - h[l-<span class="cpp-number">1</span>] * p[r-l+<span class="cpp-number">1</span>]) % B;
    <span class="cpp-keyword">if</span> (res &lt; <span class="cpp-number">0</span>) res += B;
    <span class="cpp-keyword">return</span> res;
}</code></pre>

    <h2 id="sec26.3">26.3 Thuật toán Z (Z-algorithm)</h2>
    <p>
        Mảng Z, ký hiệu là \(z\), lưu độ dài của <strong>tiền tố chung dài nhất</strong> giữa chuỗi \(s\) và hậu tố bắt đầu từ vị trí \(i\).
        Tức là \(z[i]\) bằng độ dài lớn nhất của \(k\) sao cho \(s[0 \dots k-1] = s[i \dots i+k-1]\).
    </p>

    <div class="graphic-box">
        <svg width="450" height="150" viewBox="0 0 450 150">
            <g transform="translate(20, 20)">
                <text x="15" y="-5" font-size="10">0</text> <text x="45" y="-5" font-size="10">1</text>
                <text x="75" y="-5" font-size="10">2</text> <text x="105" y="-5" font-size="10">3</text>
                <text x="135" y="-5" font-size="10">4</text> <text x="165" y="-5" font-size="10">5</text>
                <text x="195" y="-5" font-size="10">6</text> <text x="225" y="-5" font-size="10">7</text>
                <text x="255" y="-5" font-size="10">8</text> <text x="285" y="-5" font-size="10">9</text>
                <text x="315" y="-5" font-size="10">10</text>

                <rect x="0" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="15" y="20">A</text>
                <rect x="30" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="45" y="20">C</text>
                <rect x="60" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="75" y="20">B</text>
                <rect x="90" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="105" y="20">A</text>
                <rect x="120" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="135" y="20">C</text>
                
                <rect x="150" y="0" width="30" height="30" class="array-rect"/><text x="165" y="20">D</text>
                
                <rect x="180" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="195" y="20">A</text>
                <rect x="210" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="225" y="20">C</text>
                <rect x="240" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="255" y="20">B</text>
                <rect x="270" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="285" y="20">A</text>
                <rect x="300" y="0" width="30" height="30" class="array-rect highlight-rect"/><text x="315" y="20">C</text>

                <text x="-25" y="65" font-weight="bold">Z:</text>
                <rect x="0" y="45" width="30" height="30" class="array-rect"/><text x="15" y="65">-</text>
                <rect x="30" y="45" width="30" height="30" class="array-rect"/><text x="45" y="65">0</text>
                <rect x="60" y="45" width="30" height="30" class="array-rect"/><text x="75" y="65">0</text>
                <rect x="90" y="45" width="30" height="30" class="array-rect"/><text x="105" y="65">1</text>
                <rect x="120" y="45" width="30" height="30" class="array-rect"/><text x="135" y="65">0</text>
                <rect x="150" y="45" width="30" height="30" class="array-rect"/><text x="165" y="65">0</text>
                <rect x="180" y="45" width="30" height="30" class="array-rect highlight-rect"/><text x="195" y="65" font-weight="bold">5</text>
                <rect x="210" y="45" width="30" height="30" class="array-rect"/><text x="225" y="65">0</text>
                <rect x="240" y="45" width="30" height="30" class="array-rect"/><text x="255" y="65">0</text>
                <rect x="270" y="45" width="30" height="30" class="array-rect"/><text x="285" y="65">1</text>
                <rect x="300" y="45" width="30" height="30" class="array-rect"/><text x="315" y="65">0</text>

                <path d="M 180 80 L 180 90 L 330 90 L 330 80" fill="none" stroke="#d35400" stroke-width="2"/>
                <text x="255" y="110" text-anchor="middle" font-size="12" class="highlight-text">Tại i=6: khớp prefix "ACBAC" dài 5</text>
            </g>
        </svg>
    </div>

    <h3>Cài đặt</h3>
<pre><code><span class="cpp-type">vector</span>&lt;<span class="cpp-keyword">int</span>&gt; <span class="cpp-func">z_function</span>(<span class="cpp-type">string</span> s) {
    <span class="cpp-keyword">int</span> n = s.size();
    <span class="cpp-type">vector</span>&lt;<span class="cpp-keyword">int</span>&gt; z(n);
    <span class="cpp-keyword">int</span> l = <span class="cpp-number">0</span>, r = <span class="cpp-number">0</span>;
    <span class="cpp-keyword">for</span> (<span class="cpp-keyword">int</span> i = <span class="cpp-number">1</span>; i &lt; n; i++) {
        <span class="cpp-keyword">if</span> (i &lt;= r) {
            z[i] = min(r - i + <span class="cpp-number">1</span>, z[i - l]);
        }
        <span class="cpp-keyword">while</span> (i + z[i] &lt; n && s[z[i]] == s[i + z[i]]) {
            z[i]++;
        }
        <span class="cpp-keyword">if</span> (i + z[i] - <span class="cpp-number">1</span> &gt; r) {
            l = i;
            r = i + z[i] - <span class="cpp-number">1</span>;
        }
    }
    <span class="cpp-keyword">return</span> z;
}</code></pre>

    <h2 id="sec26.4">26.4 Thuật toán KMP (Knuth-Morris-Pratt)</h2>
    <p>
        Thuật toán KMP sử dụng mảng \(\pi\) (pi array, hoặc prefix function). \(\pi[i]\) là độ dài của <strong>tiền tố thực sự dài nhất</strong> của chuỗi \(s[0 \dots i]\) mà cũng là hậu tố của chuỗi đó.
    </p>

    <h3>Cài đặt</h3>
<pre><code><span class="cpp-type">vector</span>&lt;<span class="cpp-keyword">int</span>&gt; <span class="cpp-func">prefix_function</span>(<span class="cpp-type">string</span> s) {
    <span class="cpp-keyword">int</span> n = s.size();
    <span class="cpp-type">vector</span>&lt;<span class="cpp-keyword">int</span>&gt; pi(n);
    <span class="cpp-keyword">for</span> (<span class="cpp-keyword">int</span> i = <span class="cpp-number">1</span>; i &lt; n; i++) {
        <span class="cpp-keyword">int</span> j = pi[i - <span class="cpp-number">1</span>];
        <span class="cpp-keyword">while</span> (j &gt; <span class="cpp-number">0</span> && s[i] != s[j]) {
            j = pi[j - <span class="cpp-number">1</span>];
        }
        <span class="cpp-keyword">if</span> (s[i] == s[j]) {
            j++;
        }
        pi[i] = j;
    }
    <span class="cpp-keyword">return</span> pi;
}</code></pre>

</body>
</html>